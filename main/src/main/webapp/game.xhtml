<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:violet="http://violet.csu.edu.au/facelets">

	<ui:composition template="/WEB-INF/templates/default/main.xhtml">
		<ui:define name="content">
			<c:set var="screenshots" value="#{gameBean.game.screenshots}" scope="request" />
						
			<div class="game-carousel slick-carousel">
				<ui:repeat var="screenshot" value="#{screenshots}">
					<div>
						<img class="d-block img-fluid mx-auto game-screenshot" src="#{screenshot.thumbnail.URL}" />
					</div>
				</ui:repeat>
			</div>
			
			<div class="container">
				<div class="row">
					<div class="col">
						<div class="game-title-bar">
							<ui:fragment rendered="#{not empty gameBean.game.heroImage}">
								<img class="game-heroimage" src="#{gameBean.game.heroImage.URL}" />
							</ui:fragment>
							<h1 class="d-inline"><h:outputText value="#{gameBean.game.name}" /></h1>
							<div class="game-rating#{game.averageRating == null ? ' rating-muted' : ''}">
								<h:outputText id="averageRating" value="#{gameBean.game.averageRating == null ? 0 : gameBean.game.averageRating.rating}">
									<f:convertNumber minFractionDigits="1" maxFractionDigits="1"/>
								</h:outputText>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col">
						<h:form>
							<p:messages/>
							
							<label>Overall Rating</label>
							<p:rating value="#{gameBean.overallRating}" stars="10" cancel="false" />
							<ui:repeat var="characteristic" value="#{gameBean.game.characteristics}">
								<label><h:outputText value="#{characteristic.name}" /></label>
								<p:rating value="#{gameBean.characteristicRatings[characteristic]}" stars="10" cancel="false" />	
							</ui:repeat>
							
							<p:commandButton styleClass="btn btn-primary" type="submit" value="Rate" action="#{gameBean.rateGame}">
								<f:ajax execute="@form" render="@form averageRating" />
							</p:commandButton>
						</h:form>
					</div>
					
					<div class="col">
						<h:outputText value="#{gameBean.game.description}" escape="false" />
					</div>
				</div>
			</div>
				
			<script type="text/javascript">
				$(function() {
					$(".slick-carousel").slick({
				        infinite: true,
				        autoplay: true,
				        speed: 500,
				        slidesToShow: 10,
				        centerMode: true,
				        variableWidth: true,
				        draggable: false
				    });

				    function recalculateSingleSlidesToShow(container) {
				    	var containerWidth = $(container).width();
			    		var totalSlideWidth = 0;

			    		var slides = $(container).find(".slick-slide");
			    		slides.each(function() {
			    			totalSlideWidth += $(this).outerWidth();
				    	});

				    	var averageSlideWidth = totalSlideWidth / slides.length;
			    		$(container).slick("slickSetOption", "slidesToShow", Math.ceil(containerWidth / averageSlideWidth), true);
					}

				    function recalculateSlidesToShow() {
				    	$(".slick-carousel").each(function() {
				    		recalculateSingleSlidesToShow(this);
					  	});
					}

				    $(window).resize(function() {
				    	recalculateSlidesToShow();
					});

					$(recalculateSlidesToShow);
				});
			</script>
		</ui:define>
	</ui:composition>
</html>